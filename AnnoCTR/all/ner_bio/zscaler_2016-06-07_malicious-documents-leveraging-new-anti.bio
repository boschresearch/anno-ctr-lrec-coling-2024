<DOCSTART>	O	O	O	O	O	O

Malicious	O	O	O	O	O	O
Documents	O	O	O	O	O	O
leveraging	O	O	O	O	O	O
new	O	O	O	O	O	O
Anti-VM	O	O	O	O	O	O
&	O	O	O	O	O	O
Anti-Sandbox	O	O	O	O	O	O
techniques	O	O	O	O	O	O

June	O	O	B-DATE	O	O	B-DATE
07	O	O	I-DATE	O	O	I-DATE
,	O	O	I-DATE	O	O	I-DATE
2016	O	O	I-DATE	O	O	I-DATE

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Introduction	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

Zscaler	B-ORG	O	O	O	O	B-ORG
ThreatLabZ	O	O	O	O	O	O
recently	O	O	O	O	O	O
came	O	O	O	O	O	O
across	O	O	O	O	O	O
a	O	O	O	O	O	O
new	O	O	O	O	O	O
wave	O	O	O	O	O	O
of	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
evading	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
systems	O	O	O	O	O	O
using	O	O	O	O	O	O
a	O	O	O	O	O	O
new	O	O	O	O	O	O
technique	O	O	O	O	O	O
.	O	O	O	O	O	O

Malicious	O	O	O	O	O	O
executables	O	O	O	O	O	O
that	O	O	O	O	O	O
leverage	O	O	O	O	O	O
numerous	O	O	O	O	O	O
techniques	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
the	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
and	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
systems	O	O	O	O	O	O
are	O	O	O	O	O	O
 	O	O	O	O	O	O
very	O	O	O	O	O	O
common	O	O	O	O	O	O
,	O	O	O	O	O	O
but	O	O	O	O	O	O
we	O	O	O	O	O	O
are	O	O	O	O	O	O
seeing	O	O	O	O	O	O
an	O	O	O	O	O	O
increasing	O	O	O	O	O	O
trend	O	O	O	O	O	O
of	O	O	O	O	O	O
such	O	O	O	O	O	O
techniques	O	O	O	O	O	O
moving	O	O	O	O	O	O
to	O	O	O	O	O	O
the	O	O	O	O	O	O
initial	O	O	O	O	O	O
delivery	O	O	O	O	O	O
vector	O	O	O	O	O	O
(	O	O	O	O	O	O
i.e	O	O	O	O	O	O
.	O	O	O	O	O	O
weaponized	O	O	O	O	O	O
documents	O	O	O	O	O	O
)	O	O	O	O	O	O
.	O	O	O	O	O	O

In	O	O	O	O	O	O
this	O	O	O	O	O	O
blog	O	O	O	O	O	O
,	O	O	O	O	O	O
we	O	O	O	O	O	O
look	O	O	O	O	O	O
at	O	O	O	O	O	O
some	O	O	O	O	O	O
of	O	O	O	O	O	O
the	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
and	O	O	O	O	O	O
anti-sandboxing	O	O	O	O	O	O
techniques	O	O	O	O	O	O
seen	O	O	O	O	O	O
in	O	O	O	O	O	O
the	O	O	O	O	O	O
recent	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
including	O	O	O	O	O	O
the	O	O	O	O	O	O
newly	O	O	O	O	O	O
added	O	O	O	O	O	O
check	O	O	O	O	O	O
of	O	O	O	O	O	O
Microsoft	B-ORG	O	O	O	O	B-ORG
Office	O	O	O	O	O	O
RecentFiles	O	O	O	O	O	O
count	O	O	O	O	O	O
.	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Weaponized	O	O	O	O	O	O
Documents	O	O	O	O	O	O
&	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
tricks	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

Malware	O	O	O	O	O	O
authors	O	O	O	O	O	O
leveraging	O	O	O	O	O	O
documents	O	O	O	O	O	O
with	O	O	O	O	O	O
macros	O	O	O	O	O	O
to	O	O	O	O	O	O
download	O	O	O	O	O	O
and	O	O	O	O	O	O
install	O	O	O	O	O	O
malware	O	O	O	O	O	O
executable	O	O	O	O	O	O
has	O	O	O	O	O	O
been	O	O	O	O	O	O
around	O	O	O	O	O	O
for	O	O	O	O	O	O
years	O	O	O	O	O	O
;	O	O	O	O	O	O
however	O	O	O	O	O	O
,	O	O	O	O	O	O
we	O	O	O	O	O	O
are	O	O	O	O	O	O
seeing	O	O	O	O	O	O
a	O	O	O	O	O	O
gradual	O	O	O	O	O	O
evolution	O	O	O	O	O	O
in	O	O	O	O	O	O
these	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
making	O	O	O	O	O	O
it	O	O	O	O	O	O
harder	O	O	O	O	O	O
for	O	O	O	O	O	O
the	O	O	O	O	O	O
security	O	O	O	O	O	O
solutions	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
them	O	O	O	O	O	O
proactively	O	O	O	O	O	O
.	O	O	O	O	O	O

ThreatLabZ	O	O	O	O	O	O
has	O	O	O	O	O	O
seen	O	O	O	O	O	O
hundreds	O	O	O	O	O	O
of	O	O	O	O	O	O
new	O	O	O	O	O	O
weaponized	O	O	O	O	O	O
documents	O	O	O	O	O	O
hit	O	O	O	O	O	O
our	O	O	O	O	O	O
sandbox	O	O	O	O	O	O
on	O	O	O	O	O	O
a	O	O	O	O	O	O
regular	O	O	O	O	O	O
basis	O	O	O	O	O	O
:	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
Q2MaliciousDocuments.PNG	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
1	O	O	O	O	O	O
:	O	O	O	O	O	O
New	O	O	O	O	O	O
unique	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
*	O	O	O	O	O	O

A	O	O	O	O	O	O
macro	O	O	O	O	O	O
is	O	O	O	O	O	O
a	O	O	O	O	O	O
piece	O	O	O	O	O	O
of	O	O	O	O	O	O
code	O	O	O	O	O	O
,	O	O	O	O	O	O
embedded	O	O	O	O	O	O
inside	O	O	O	O	O	O
Microsoft	B-ORG	O	O	O	O	B-ORG
Office	O	O	O	O	O	O
documents	O	O	O	O	O	O
,	O	O	O	O	O	O
written	O	O	O	O	O	O
in	O	O	O	O	O	O
a	O	O	O	O	O	O
programming	O	O	O	O	O	O
language	O	O	O	O	O	O
known	O	O	O	O	O	O
as	O	O	O	O	O	O
Visual	O	O	O	O	O	O
Basic	O	O	O	O	O	O
for	O	O	O	O	O	O
Applications	O	O	O	O	O	O
(	O	O	O	O	O	O
VBA	O	O	O	O	O	O
)	O	O	O	O	O	O
.	O	O	O	O	O	O

Microsoft	B-ORG	O	O	O	O	B-ORG
Office's	O	O	O	O	O	O
default	O	O	O	O	O	O
security	O	O	O	O	O	O
settings	O	O	O	O	O	O
ensures	O	O	O	O	O	O
that	O	O	O	O	O	O
the	O	O	O	O	O	O
macros	O	O	O	O	O	O
are	O	O	O	O	O	O
disabled	O	O	O	O	O	O
by	O	O	O	O	O	O
default	O	O	O	O	O	O
;	O	O	O	O	O	O
however	O	O	O	O	O	O
,	O	O	O	O	O	O
attackers	O	O	O	O	O	O
are	O	O	O	O	O	O
using	O	O	O	O	O	O
clever	O	O	O	O	O	O
social	O	O	O	O	O	O
engineering	O	O	O	O	O	O
tactics	O	O	O	O	O	O
to	O	O	O	O	O	O
lure	O	O	O	O	O	O
the	O	O	O	O	O	O
user	O	O	O	O	O	O
into	O	O	O	O	O	O
enabling	O	O	O	O	O	O
the	O	O	O	O	O	O
macros	O	O	O	O	O	O
.	O	O	O	O	O	O

Below	O	O	O	O	O	O
are	O	O	O	O	O	O
two	O	O	O	O	O	O
recent	O	O	O	O	O	O
examples	O	O	O	O	O	O
:	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
EnableMacro.PNG	O	O	O	O	O	O
)	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
EnableMacro_social1	O	O	O	O	O	O
.	O	O	O	O	O	O
PNG	O	O	O	O	O	O
)	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
EnableMacro_social2	O	O	O	O	O	O
.	O	O	O	O	O	O
PNG	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
2	O	O	O	O	O	O
:	O	O	O	O	O	O
Social	O	O	O	O	O	O
engineering	O	O	O	O	O	O
tactics	O	O	O	O	O	O
to	O	O	O	O	O	O
enable	O	O	O	O	O	O
macro	O	O	O	O	O	O
*	O	O	O	O	O	O

Malware	O	O	O	O	O	O
authors	O	O	O	O	O	O
are	O	O	O	O	O	O
also	O	O	O	O	O	O
making	O	O	O	O	O	O
the	O	O	O	O	O	O
macro	O	O	O	O	O	O
code	O	O	O	O	O	O
highly	O	O	O	O	O	O
obfuscated	O	O	O	O	O	O
and	O	O	O	O	O	O
difficult	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
by	O	O	O	O	O	O
signature	O	O	O	O	O	O
based	O	O	O	O	O	O
systems	O	O	O	O	O	O
.	O	O	O	O	O	O

In	O	O	O	O	O	O
addition	O	O	O	O	O	O
to	O	O	O	O	O	O
highly	O	O	O	O	O	O
obfuscated	O	O	O	O	O	O
macros	O	O	O	O	O	O
,	O	O	O	O	O	O
malware	O	O	O	O	O	O
authors	O	O	O	O	O	O
are	O	O	O	O	O	O
using	O	O	O	O	O	O
multiple	O	O	O	O	O	O
techniques	O	O	O	O	O	O
in	O	O	O	O	O	O
macros	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
the	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
and	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
systems	O	O	O	O	O	O
as	O	O	O	O	O	O
seen	O	O	O	O	O	O
below	O	O	O	O	O	O
:	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Check	O	O	O	O	O	O
#1	O	O	O	O	O	O
-	O	O	O	O	O	O
Look	O	O	O	O	O	O
for	O	O	O	O	O	O
standard	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
strings	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
VirtualEnvironment_Check1	O	O	O	O	O	O
.	O	O	O	O	O	O
png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
3	O	O	O	O	O	O
:	O	O	O	O	O	O
Virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
strings	O	O	O	O	O	O
check	O	O	O	O	O	O
*	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Check	O	O	O	O	O	O
#2	O	O	O	O	O	O
-	O	O	O	O	O	O
Windows	O	O	O	O	O	O
Management	O	O	O	O	O	O
Instrumentation	O	O	O	O	O	O
(	O	O	O	O	O	O
WMI	O	O	O	O	O	O
)	O	O	O	O	O	O
interface	O	O	O	O	O	O
to	O	O	O	O	O	O
identify	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
&	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
systems	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
VirtualEnvironment_Check2	O	O	O	O	O	O
.	O	O	O	O	O	O
png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
4	O	O	O	O	O	O
:	O	O	O	O	O	O
WMI	O	O	O	O	O	O
interface	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
&	O	O	O	O	O	O
sandboxes	O	O	O	O	O	O
*	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Check	O	O	O	O	O	O
#3	O	O	O	O	O	O
-	O	O	O	O	O	O
Look	O	O	O	O	O	O
for	O	O	O	O	O	O
presence	O	O	O	O	O	O
of	O	O	O	O	O	O
known	O	O	O	O	O	O
analysis	O	O	O	O	O	O
tools	O	O	O	O	O	O
on	O	O	O	O	O	O
the	O	O	O	O	O	O
system	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
AnalysisTools_Check.png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
5	O	O	O	O	O	O
:	O	O	O	O	O	O
Check	O	O	O	O	O	O
for	O	O	O	O	O	O
malware	O	O	O	O	O	O
analysis	O	O	O	O	O	O
tools	O	O	O	O	O	O
*	O	O	O	O	O	O

If	O	O	O	O	O	O
any	O	O	O	O	O	O
of	O	O	O	O	O	O
these	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
or	O	O	O	O	O	O
anti-sandbox	O	O	O	O	O	O
checks	O	O	O	O	O	O
is	O	O	O	O	O	O
positive	O	O	O	O	O	O
then	O	O	O	O	O	O
the	O	O	O	O	O	O
VBA	O	O	O	O	O	O
macro	O	O	O	O	O	O
code	O	O	O	O	O	O
execution	O	O	O	O	O	O
terminates	O	O	O	O	O	O
and	O	O	O	O	O	O
the	O	O	O	O	O	O
end	O	O	O	O	O	O
malware	O	O	O	O	O	O
payload	O	O	O	O	O	O
does	O	O	O	O	O	O
not	O	O	O	O	O	O
get	O	O	O	O	O	O
downloaded	O	O	O	O	O	O
on	O	O	O	O	O	O
the	O	O	O	O	O	O
system	O	O	O	O	O	O
shielding	O	O	O	O	O	O
it	O	O	O	O	O	O
from	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
and	O	O	O	O	O	O
detection	O	O	O	O	O	O
.	O	O	O	O	O	O

Alternately	O	O	O	O	O	O
,	O	O	O	O	O	O
the	O	O	O	O	O	O
malicious	O	O	O	O	O	O
document	O	O	O	O	O	O
will	O	O	O	O	O	O
download	O	O	O	O	O	O
and	O	O	O	O	O	O
install	O	O	O	O	O	O
a	O	O	O	O	O	O
malware	O	O	O	O	O	O
executable	O	O	O	O	O	O
on	O	O	O	O	O	O
the	O	O	O	O	O	O
victim's	O	O	O	O	O	O
system	O	O	O	O	O	O
if	O	O	O	O	O	O
all	O	O	O	O	O	O
the	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
checks	O	O	O	O	O	O
fail	O	O	O	O	O	O
.	O	O	O	O	O	O

We	O	O	O	O	O	O
have	O	O	O	O	O	O
seen	O	O	O	O	O	O
multiple	O	O	O	O	O	O
malware	O	O	O	O	O	O
families	O	O	O	O	O	O
leveraging	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
as	O	O	O	O	O	O
the	O	O	O	O	O	O
initial	O	O	O	O	O	O
delivery	O	O	O	O	O	O
vector	O	O	O	O	O	O
:	O	O	O	O	O	O

*	O	O	O	O	O	O
Ransomware	O	O	O	O	O	O
Trojans	O	O	O	O	O	O
(	O	O	O	O	O	O
e.g	O	O	O	O	O	O
.	O	O	O	O	O	O
CryptoWall	O	O	O	O	O	O
,	O	O	O	O	O	O
Locky	O	O	O	O	O	O
,	O	O	O	O	O	O
Cerber	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Banking	O	O	O	O	O	O
Trojans	O	O	O	O	O	O
(	O	O	O	O	O	O
e.g	O	O	O	O	O	O
.	O	O	O	O	O	O
Dridex	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Backdoor	O	O	O	O	O	O
Trojans	O	O	O	O	O	O
(	O	O	O	O	O	O
e.g	O	O	O	O	O	O
.	O	O	O	O	O	O
Matsnu	O	O	O	O	O	O
,	O	O	O	O	O	O
Kasidet	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Infostealer	O	O	O	O	O	O
Trojans	O	O	O	O	O	O
(	O	O	O	O	O	O
e.g	O	O	O	O	O	O
.	O	O	O	O	O	O
Fareit	O	O	O	O	O	O
,	O	O	O	O	O	O
VawTrak	O	O	O	O	O	O
,	O	O	O	O	O	O
Pony	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
New	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
and	O	O	O	O	O	O
anti-sandbox	O	O	O	O	O	O
checks	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

In	O	O	O	O	O	O
the	O	O	O	O	O	O
last	O	O	O	O	O	O
week	O	O	O	O	O	O
of	O	O	O	O	O	O
May	O	O	B-DATE	O	O	B-DATE
,	O	O	O	O	O	O
we	O	O	O	O	O	O
started	O	O	O	O	O	O
seeing	O	O	O	O	O	O
a	O	O	O	O	O	O
new	O	O	O	O	O	O
wave	O	O	O	O	O	O
of	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
leveraging	O	O	O	O	O	O
two	O	O	O	O	O	O
new	O	O	O	O	O	O
techniques	O	O	O	O	O	O
that	O	O	O	O	O	O
prevents	O	O	O	O	O	O
it	O	O	O	O	O	O
from	O	O	O	O	O	O
executing	O	O	O	O	O	O
on	O	O	O	O	O	O
many	O	O	O	O	O	O
known	O	O	O	O	O	O
sandbox	O	O	O	O	O	O
solutions	O	O	O	O	O	O
.	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
New	O	O	O	O	O	O
Check	O	O	O	O	O	O
#1	O	O	O	O	O	O
-	O	O	O	O	O	O
Detect	O	O	O	O	O	O
virtual	O	O	O	O	O	O
environment	O	O	O	O	O	O
via	O	O	O	O	O	O
Office	O	O	O	O	O	O
RecentFiles	O	O	O	O	O	O
property	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
VirtualEnvironment_Check3	O	O	O	O	O	O
.	O	O	O	O	O	O
png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
6	O	O	O	O	O	O
:	O	O	O	O	O	O
Microsoft	B-ORG	O	O	O	O	B-ORG
Office	O	O	O	O	O	O
RecentFiles	O	O	O	O	O	O
property	O	O	O	O	O	O
check	O	O	O	O	O	O
*	O	O	O	O	O	O

RecentFiles	O	O	O	O	O	O
property	O	O	O	O	O	O
returns	O	O	O	O	O	O
a	O	O	O	O	O	O
RecentFiles	O	O	O	O	O	O
collection	O	O	O	O	O	O
that	O	O	O	O	O	O
represents	O	O	O	O	O	O
the	O	O	O	O	O	O
most	O	O	O	O	O	O
recently	O	O	O	O	O	O
accessed	O	O	O	O	O	O
files	O	O	O	O	O	O
.	O	O	O	O	O	O

The	O	O	O	O	O	O
macro	O	O	O	O	O	O
code	O	O	O	O	O	O
checks	O	O	O	O	O	O
if	O	O	O	O	O	O
the	O	O	O	O	O	O
number	O	O	O	O	O	O
of	O	O	O	O	O	O
RecentFiles	O	O	O	O	O	O
collection	O	O	O	O	O	O
is	O	O	O	O	O	O
less	O	O	O	O	O	O
than	O	O	O	O	O	O
a	O	O	O	O	O	O
predefined	O	O	O	O	O	O
threshold	O	O	O	O	O	O
and	O	O	O	O	O	O
terminates	O	O	O	O	O	O
if	O	O	O	O	O	O
true	O	O	O	O	O	O
.	O	O	O	O	O	O

Threshold	O	O	O	O	O	O
value	O	O	O	O	O	O
we	O	O	O	O	O	O
have	O	O	O	O	O	O
seen	O	O	O	O	O	O
is	O	O	O	O	O	O
3	O	O	O	O	O	O
or	O	O	O	O	O	O
higher	O	O	O	O	O	O
.	O	O	O	O	O	O

The	O	O	O	O	O	O
malware	O	O	O	O	O	O
author	O	O	O	O	O	O
makes	O	O	O	O	O	O
an	O	O	O	O	O	O
assumption	O	O	O	O	O	O
here	O	O	O	O	O	O
that	O	O	O	O	O	O
most	O	O	O	O	O	O
clean	O	O	O	O	O	O
Virtual	O	O	O	O	O	O
Environment	O	O	O	O	O	O
snapshots	O	O	O	O	O	O
will	O	O	O	O	O	O
be	O	O	O	O	O	O
taken	O	O	O	O	O	O
after	O	O	O	O	O	O
a	O	O	O	O	O	O
fresh	O	O	O	O	O	O
Microsoft	B-ORG	O	O	O	O	B-ORG
Office	O	O	O	O	O	O
install	O	O	O	O	O	O
with	O	O	O	O	O	O
probably	O	O	O	O	O	O
one	O	O	O	O	O	O
or	O	O	O	O	O	O
two	O	O	O	O	O	O
document	O	O	O	O	O	O
files	O	O	O	O	O	O
opened	O	O	O	O	O	O
for	O	O	O	O	O	O
testing	O	O	O	O	O	O
the	O	O	O	O	O	O
installation	O	O	O	O	O	O
.	O	O	O	O	O	O

Alternately	O	O	O	O	O	O
,	O	O	O	O	O	O
a	O	O	O	O	O	O
standard	O	O	O	O	O	O
user	O	O	O	O	O	O
system	O	O	O	O	O	O
with	O	O	O	O	O	O
Office	O	O	O	O	O	O
applications	O	O	O	O	O	O
should	O	O	O	O	O	O
have	O	O	O	O	O	O
at	O	O	O	O	O	O
least	O	O	O	O	O	O
3	O	O	O	O	O	O
or	O	O	O	O	O	O
more	O	O	O	O	O	O
recently	O	O	O	O	O	O
accessed	O	O	O	O	O	O
document	O	O	O	O	O	O
files	O	O	O	O	O	O
.	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
New	O	O	O	O	O	O
Check	O	O	O	O	O	O
#2	O	O	O	O	O	O
-	O	O	O	O	O	O
Check	O	O	O	O	O	O
for	O	O	O	O	O	O
the	O	O	O	O	O	O
external	O	O	O	O	O	O
IP	O	O	O	O	O	O
ownership	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
AnalysisTools_Check2	O	O	O	O	O	O
.	O	O	O	O	O	O
png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
7	O	O	O	O	O	O
:	O	O	O	O	O	O
Check	O	O	O	O	O	O
for	O	O	O	O	O	O
security	O	O	O	O	O	O
vendors	O	O	O	O	O	O
,	O	O	O	O	O	O
cloud	O	O	O	O	O	O
&	O	O	O	O	O	O
hosting	O	O	O	O	O	O
services	O	O	O	O	O	O
*	O	O	O	O	O	O

Here	O	O	O	O	O	O
the	O	O	O	O	O	O
malware	O	O	O	O	O	O
author	O	O	O	O	O	O
is	O	O	O	O	O	O
leveraging	O	O	O	O	O	O
macro	O	O	O	O	O	O
to	O	O	O	O	O	O
get	O	O	O	O	O	O
the	O	O	O	O	O	O
external	O	O	O	O	O	O
IP	O	O	O	O	O	O
address	O	O	O	O	O	O
of	O	O	O	O	O	O
the	O	O	O	O	O	O
victim's	O	O	O	O	O	O
system	O	O	O	O	O	O
by	O	O	O	O	O	O
using	O	O	O	O	O	O
the	O	O	O	O	O	O
following	O	O	O	O	O	O
maxmind	O	O	O	O	O	O
GeoIP	O	O	O	O	O	O
service	O	O	O	O	O	O
API	O	O	O	O	O	O
:	O	O	O	O	O	O

https	O	O	O	O	O	O
:	O	O	O	O	O	O
/	O	O	O	O	O	O
/	O	O	O	O	O	O
www.maxmind.com	O	O	O	O	O	O
/	O	O	O	O	O	O
geoip	O	O	O	O	O	O
/	O	O	O	O	O	O
v2.1	O	O	O	O	O	O
/	O	O	O	O	O	O
city	O	O	O	O	O	O
/	O	O	O	O	O	O
me	O	O	O	O	O	O

This	O	O	O	O	O	O
 	O	O	O	O	O	O
API	O	O	O	O	O	O
 	O	O	O	O	O	O
asks	O	O	O	O	O	O
for	O	O	O	O	O	O
user	O	O	O	O	O	O
credentials	O	O	O	O	O	O
but	O	O	O	O	O	O
we	O	O	O	O	O	O
did	O	O	O	O	O	O
not	O	O	O	O	O	O
see	O	O	O	O	O	O
any	O	O	O	O	O	O
hardcoded	O	O	O	O	O	O
credential	O	O	O	O	O	O
information	O	O	O	O	O	O
being	O	O	O	O	O	O
sent	O	O	O	O	O	O
by	O	O	O	O	O	O
the	O	O	O	O	O	O
malicious	O	O	O	O	O	O
document	O	O	O	O	O	O
.	O	O	O	O	O	O

The	O	O	O	O	O	O
malware	O	O	O	O	O	O
author	O	O	O	O	O	O
is	O	O	O	O	O	O
setting	O	O	O	O	O	O
the	O	O	O	O	O	O
UserAgent	O	O	O	O	O	O
and	O	O	O	O	O	O
Referer	O	O	O	O	O	O
headers	O	O	O	O	O	O
for	O	O	O	O	O	O
this	O	O	O	O	O	O
request	O	O	O	O	O	O
to	O	O	O	O	O	O
get	O	O	O	O	O	O
the	O	O	O	O	O	O
response	O	O	O	O	O	O
without	O	O	O	O	O	O
any	O	O	O	O	O	O
authentication	O	O	O	O	O	O
.	O	O	O	O	O	O

We	O	O	O	O	O	O
are	O	O	O	O	O	O
still	O	O	O	O	O	O
verifying	O	O	O	O	O	O
if	O	O	O	O	O	O
this	O	O	O	O	O	O
is	O	O	O	O	O	O
by	O	O	O	O	O	O
design	O	O	O	O	O	O
or	O	O	O	O	O	O
if	O	O	O	O	O	O
this	O	O	O	O	O	O
is	O	O	O	O	O	O
an	O	O	O	O	O	O
authentication	O	O	O	O	O	O
bypass	O	O	O	O	O	O
issue	O	O	O	O	O	O
for	O	O	O	O	O	O
the	O	O	O	O	O	O
API	O	O	O	O	O	O
that	O	O	O	O	O	O
is	O	O	O	O	O	O
being	O	O	O	O	O	O
exploited	O	O	O	O	O	O
.	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
Maxmind_check.PNG	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
8	O	O	O	O	O	O
:	O	O	O	O	O	O
Maxmind	O	O	O	O	O	O
API	O	O	O	O	O	O
usage	O	O	O	O	O	O
for	O	O	O	O	O	O
external	O	O	O	O	O	O
IP	O	O	O	O	O	O
information	O	O	O	O	O	O
*	O	O	O	O	O	O

The	O	O	O	O	O	O
response	O	O	O	O	O	O
is	O	O	O	O	O	O
then	O	O	O	O	O	O
compared	O	O	O	O	O	O
against	O	O	O	O	O	O
a	O	O	O	O	O	O
predetermined	O	O	O	O	O	O
list	O	O	O	O	O	O
of	O	O	O	O	O	O
strings	O	O	O	O	O	O
(	O	O	O	O	O	O
Figure	O	O	O	O	O	O
X	O	O	O	O	O	O
)	O	O	O	O	O	O
that	O	O	O	O	O	O
includes	O	O	O	O	O	O
multiple	O	O	O	O	O	O
known	O	O	O	O	O	O
security	O	O	O	O	O	O
vendors	O	O	O	O	O	O
&	O	O	O	O	O	O
hosting	O	O	O	O	O	O
services	O	O	O	O	O	O
as	O	O	O	O	O	O
well	O	O	O	O	O	O
as	O	O	O	O	O	O
generic	O	O	O	O	O	O
strings	O	O	O	O	O	O
to	O	O	O	O	O	O
detect	O	O	O	O	O	O
data	O	O	O	O	O	O
centers	O	O	O	O	O	O
,	O	O	O	O	O	O
hosting	O	O	O	O	O	O
services	O	O	O	O	O	O
,	O	O	O	O	O	O
cloud	O	O	O	O	O	O
based	O	O	O	O	O	O
security	O	O	O	O	O	O
and	O	O	O	O	O	O
hosting	O	O	O	O	O	O
services	O	O	O	O	O	O
ownership	O	O	O	O	O	O
.	O	O	O	O	O	O

The	O	O	O	O	O	O
macro	O	O	O	O	O	O
execution	O	O	O	O	O	O
will	O	O	O	O	O	O
terminate	O	O	O	O	O	O
if	O	O	O	O	O	O
maxmind's	O	O	O	O	O	O
response	O	O	O	O	O	O
for	O	O	O	O	O	O
the	O	O	O	O	O	O
external	O	O	O	O	O	O
IP	O	O	O	O	O	O
address	O	O	O	O	O	O
matches	O	O	O	O	O	O
any	O	O	O	O	O	O
of	O	O	O	O	O	O
these	O	O	O	O	O	O
strings	O	O	O	O	O	O
.	O	O	O	O	O	O

Upon	O	O	O	O	O	O
successful	O	O	O	O	O	O
checks	O	O	O	O	O	O
,	O	O	O	O	O	O
these	O	O	O	O	O	O
new	O	O	O	O	O	O
set	O	O	O	O	O	O
of	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
were	O	O	O	O	O	O
found	O	O	O	O	O	O
to	O	O	O	O	O	O
be	O	O	O	O	O	O
downloading	O	O	O	O	O	O
and	O	O	O	O	O	O
installing	O	O	O	O	O	O
Win32	O	O	O	O	O	O
/	O	O	O	O	O	O
Matsnu.Q	O	O	O	O	O	O
Trojan	O	O	O	O	O	O
from	O	O	O	O	O	O
following	O	O	O	O	O	O
URLs	O	O	O	O	O	O
:	O	O	O	O	O	O

*	O	O	O	O	O	O
arabtradenet	O	O	O	O	O	O
[	O	O	O	O	O	O
.	O	O	O	O	O	O
]	O	O	O	O	O	O
com	O	O	O	O	O	O
/	O	O	O	O	O	O
info	O	O	O	O	O	O
/	O	O	O	O	O	O
content.dat	O	O	O	O	O	O

*	O	O	O	O	O	O
naivak	O	O	O	O	O	O
[	O	O	O	O	O	O
.	O	O	O	O	O	O
]	O	O	O	O	O	O
com	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
office14	O	O	O	O	O	O
.	O	O	O	O	O	O
ppb	O	O	O	O	O	O

!	O	O	O	O	O	O
[	O	O	O	O	O	O
]	O	O	O	O	O	O
(	O	O	O	O	O	O
/	O	O	O	O	O	O
cdn-cgi	O	O	O	O	O	O
/	O	O	O	O	O	O
image	O	O	O	O	O	O
/	O	O	O	O	O	O
format	O	O	O	O	O	O
=	O	O	O	O	O	O
auto	O	O	O	O	O	O
/	O	O	O	O	O	O
sites	O	O	O	O	O	O
/	O	O	O	O	O	O
default	O	O	O	O	O	O
/	O	O	O	O	O	O
files	O	O	O	O	O	O
/	O	O	O	O	O	O
images	O	O	O	O	O	O
/	O	O	O	O	O	O
blogs	O	O	O	O	O	O
/	O	O	O	O	O	O
DocExe_download.png	O	O	O	O	O	O
)	O	O	O	O	O	O

*	O	O	O	O	O	O
Figure	O	O	O	O	O	O
9	O	O	O	O	O	O
:	O	O	O	O	O	O
Matsnu	O	O	O	O	O	O
executable	O	O	O	O	O	O
payload	O	O	O	O	O	O
being	O	O	O	O	O	O
downloaded	O	O	O	O	O	O
*	O	O	O	O	O	O

We	O	O	O	O	O	O
also	O	O	O	O	O	O
saw	O	O	O	O	O	O
Nitol	O	O	O	O	O	O
and	O	O	O	O	O	O
Nymaim	O	O	O	O	O	O
payloads	O	O	O	O	O	O
subsequently	O	O	O	O	O	O
being	O	O	O	O	O	O
dropped	O	O	O	O	O	O
by	O	O	O	O	O	O
Matsnu	O	O	O	O	O	O
Trojan	O	O	O	O	O	O
.	O	O	O	O	O	O

*	O	O	O	O	O	O
*	O	O	O	O	O	O
Conclusion	O	O	O	O	O	O
*	O	O	O	O	O	O
*	O	O	O	O	O	O

Malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
with	O	O	O	O	O	O
highly	O	O	O	O	O	O
obfuscated	O	O	O	O	O	O
macros	O	O	O	O	O	O
have	O	O	O	O	O	O
become	O	O	O	O	O	O
an	O	O	O	O	O	O
increasingly	O	O	O	O	O	O
popular	O	O	O	O	O	O
vector	O	O	O	O	O	O
among	O	O	O	O	O	O
cyber	O	O	O	O	O	O
criminals	O	O	O	O	O	O
to	O	O	O	O	O	O
deliver	O	O	O	O	O	O
malware	O	O	O	O	O	O
executable	O	O	O	O	O	O
payloads	O	O	O	O	O	O
.	O	O	O	O	O	O

By	O	O	O	O	O	O
adding	O	O	O	O	O	O
newer	O	O	O	O	O	O
anti-VM	O	O	O	O	O	O
and	O	O	O	O	O	O
anti-analysis	O	O	O	O	O	O
techniques	O	O	O	O	O	O
to	O	O	O	O	O	O
the	O	O	O	O	O	O
malicious	O	O	O	O	O	O
documents	O	O	O	O	O	O
itself	O	O	O	O	O	O
,	O	O	O	O	O	O
the	O	O	O	O	O	O
attackers	O	O	O	O	O	O
are	O	O	O	O	O	O
protecting	O	O	O	O	O	O
the	O	O	O	O	O	O
end	O	O	O	O	O	O
executable	O	O	O	O	O	O
payloads	O	O	O	O	O	O
from	O	O	O	O	O	O
being	O	O	O	O	O	O
downloaded	O	O	O	O	O	O
and	O	O	O	O	O	O
detected	O	O	O	O	O	O
by	O	O	O	O	O	O
the	O	O	O	O	O	O
automated	O	O	O	O	O	O
analysis	O	O	O	O	O	O
systems	O	O	O	O	O	O
.	O	O	O	O	O	O

Zscaler	B-ORG	O	O	O	O	B-ORG
ThreatLabZ	O	O	O	O	O	O
will	O	O	O	O	O	O
continue	O	O	O	O	O	O
to	O	O	O	O	O	O
monitor	O	O	O	O	O	O
and	O	O	O	O	O	O
ensure	O	O	O	O	O	O
coverage	O	O	O	O	O	O
against	O	O	O	O	O	O
the	O	O	O	O	O	O
evolving	O	O	O	O	O	O
malicious	O	O	O	O	O	O
document	O	O	O	O	O	O
threat	O	O	O	O	O	O
as	O	O	O	O	O	O
well	O	O	O	O	O	O
as	O	O	O	O	O	O
subsequent	O	O	O	O	O	O
malware	O	O	O	O	O	O
executable	O	O	O	O	O	O
payloads	O	O	O	O	O	O
.	O	O	O	O	O	O

*	O	O	O	O	O	O
Research	O	O	O	O	O	O
by	O	O	O	O	O	O
:	O	O	O	O	O	O
Deepen	O	O	O	O	O	O
Desai	O	O	O	O	O	O
,	O	O	O	O	O	O
Nirmal	O	O	O	O	O	O
Singh	O	O	O	O	O	O
,	O	O	O	O	O	O
Tarun	O	O	O	O	O	O
Dewan	O	O	O	O	O	O
*	O	O	O	O	O	O

